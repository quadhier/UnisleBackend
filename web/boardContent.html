<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" charset="UTF-8">
    <link href="css/forum/boardContentCSS.css"  rel="stylesheet" type="text/css"/>
    <link href="css/animate.min.css" rel="stylesheet" type="text/css"/>
    <script src="js/jquery-1.8.3.min.js"></script>
    <script src="js/jquery-ui-1.8.10.custom.min.js"></script>
    <script src="js/article/article.js"></script>
    <script src="js/jPages.js"></script>
    <title>SearchResult</title>
    <script>
        $(document).ready(function () {
            alert(document.URL);
            var boardname = document.URL.split('?')[1].split('&')[0].split('=')[1];
            var themename = document.URL.split('?')[1].split('&')[1].split('=')[1];
            var articleList;
            function showArticleWithTheme() {
                /*
                 一定要注意！没有内容的.theme_content也会被点击到，导致下面层的.theme_content不能被点击
                 */
                $.ajax({
                    type: "GET",
                    url: "forum/article/all",
                    dataType: "json",
                    async:false,
                    data:{
                        'boardName':boardname,
                        'themeName':themename,
                        'startAt':'0',
                        'number':'100'
                    },
                    timeout:5000,
                    success: function (res) {
                        if(res.result == 'LOGINERROR'){
                            window.reload('login.html');
                        }
                        if(res.result != 'SUCCESS'){
                            alert('获取文章列表失败，请刷新。')
                        }
                        articleList = res.data;
                    }

                });//给articleList赋值
                if(articleList==null || articleList.length==0)
                    return;
                for(var i=0;i<articleList.length;i++) {

                    var articleId = articleList[i].articleid;
                    var articleTitle = articleList[i].title;
                    var articleAuthor = articleList[i].author;
                    var lastComTime = new Date(parseInt(articleList[i].lastcomdatetime)).toLocaleString().replace(/:d{1,2}$/,' ');
                    var visitNumber = articleList[i].viewtimes;

                    var articleAuthorForumAccount;
                    $.ajax({
                        type: "GET",
                        url: "forum/userinfo",
                        dataType: "json",
                        data: {
                            'userid': articleAuthor
                        },
                        async:false,
                        timeout: 5000,
                        success: function (res) {
                            articleAuthorForumAccount = res.data;
                        }
                    });

                    $('#itemContainer').append(
                        '<div class="board_content_item" id="'+articleId+'" >'+
                        '<div class="item_top"><img src="images/forum/good.png" class="item_top_img_good"/><span>'+articleTitle+'</span><img src="images/forum/comment.png" class="item_top_img_comment"/></div>'+
                        '<div class="item_bottom">'+
                        '<span class="item_good_num">20</span>'+
                        '<span class="item_author_time">'+
                        '<span class="item_author" id="'+articleAuthor+'">作者:'+articleAuthorForumAccount.nickname+'</span>'+
                        '<span>&nbsp;最后评论:&nbsp;</span>'+
                        '<span class="item_time">'+lastComTime+'</span>'+
                        '</span>'+
                        '<span class="item_comment_num">'+visitNumber+'</span>'+
                        '</div>'+
                        '</div>'
                    );
                }
            }
            function jumpToArticleContent(articleId,authorId){
                var newURL = 'article.html?'+'id='+articleId+'&author='+authorId;
                window.location.replace(newURL);
            }
            $("div.holder").jPages({
                containerID: "itemContainer",
                previous: "←",
                next: "→",
                perPage: 20
            });
            $('.board_content_item').live('click',function () {
                var articleid = $(this).attr('id');
                var authorid = $(this).find($('.item_author')).attr('id');
                jumpToArticleContent(articleid,authorid);
            });
            showArticleWithTheme();
        });

    </script>
</head>
<body>
<div id="container" class="clearfix">
    <!--! end of #sidebar -->
    <div id="content" class="defaults">
        <!-- navigation holder -->
        <!--<div class="holder">-->
        <!--</div>-->
        <!-- item container -->
        <ul id="itemContainer">

            <!--<div><img src="images/img (10).jpg" alt="image"></div>-->
        </ul>
        <!-- navigation holder -->
        <div class="holder">
        </div>
    </div>
    <!--! end of #content -->
</div>
</body>